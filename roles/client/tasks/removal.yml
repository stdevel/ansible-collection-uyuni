---
- name: Stop services
  ansible.builtin.service:
    name: "{{ client_minion_service }}"
    state: stopped
    enabled: false
  register: client_service_stop
  failed_when:
    - client_service_stop.failed
    - "'not find' not in client_service_stop.msg"
  become: true

- name: Remove packages
  ansible.builtin.package:
    name: "{{ client_packages }}"
    state: absent
  become: true

- name: Remove directories
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  become: true
  loop: "{{ client_directories }}"
